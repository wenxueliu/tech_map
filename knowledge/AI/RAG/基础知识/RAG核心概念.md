# RAG核心概念详解

## 概述
- **分类**: AI/机器学习/RAG/基础知识
- **创建时间**: 2025-10-19
- **更新时间**: 2025-10-19
- **关键词**: RAG, Embedding, 向量检索, 相似度计算

## 1. RAG工作原理

### 基本流程
```
用户查询 → 向量化 → 相似度检索 → 上下文构建 → LLM生成 → 返回结果
```

### 详细步骤
1. **文档预处理**: 将原始文档分块（chunking）
2. **向量化**: 使用Embedding模型将文本转换为向量
3. **向量存储**: 将向量存储到向量数据库
4. **检索**: 根据查询向量检索相似的文档片段
5. **上下文组合**: 将检索到的信息与用户查询组合
6. **生成**: LLM基于上下文生成最终回答

## 2. Embedding技术

### 什么是Embedding
Embedding是将高维文本数据映射到低维连续向量空间的技术，使得语义相似的文本在向量空间中距离相近。

### 主流Embedding模型
- **OpenAI**: text-embedding-ada-002, text-embedding-3-small/large
- **Hugging Face**: sentence-transformers系列
- **开源模型**: BGE, M3E, E5

### Embedding选择标准
- **维度**: 通常在256-4096之间
- **性能**: 准确性与速度的平衡
- **语言支持**: 中文、英文或多语言
- **部署方式**: API调用或本地部署

## 3. 向量数据库

### 核心功能
- **向量存储**: 高效存储高维向量
- **相似度搜索**: 快速检索最相似的向量
- **元数据管理**: 存储文本内容和相关信息
- **扩展性**: 支持大规模数据

### 主流向量数据库对比

| 数据库 | 特点 | 适用场景 | 开源状态 |
|--------|------|----------|----------|
| ChromaDB | 轻量级、易用 | 小到中型项目 | 开源 |
| Pinecone | 云原生、高性能 | 企业级应用 | 商业 |
| Weaviate | 语义搜索、GraphQL | 知识图谱应用 | 开源 |
| FAISS | 高性能算法库 | 大规模检索 | 开源库 |
| Milvus | 分布式架构 | 企业级搜索 | 开源 |

## 4. 相似度计算方法

### 常用距离度量
- **余弦相似度**: 最常用，关注向量方向而非大小
- **欧几里得距离**: 关注向量在空间中的实际距离
- **点积**: 计算简单，适合某些特定场景

### 选择建议
- **文本检索**: 余弦相似度
- **数值特征**: 欧几里得距离
- **高维稀疏向量**: 点积

## 5. 文档分块策略

### 分块方法
1. **固定长度分块**: 简单但可能切断语义
2. **按段落分块**: 保持语义完整性
3. **递归分块**: 保持句子和段落结构
4. **语义分块**: 基于内容相似性

### 分块大小选择
- **小chunk (256-512 tokens)**: 检索精确，但可能缺少上下文
- **中chunk (512-1024 tokens)**: 平衡精度和上下文
- **大chunk (1024-2048 tokens)**: 上下文丰富，但噪声较多

### 重叠策略
- **滑动窗口**: 保持语义连续性
- **重叠比例**: 通常10%-20%

## 6. 检索策略

### 基础检索
- **向量检索**: 基于语义相似度
- **关键词检索**: 基于精确匹配
- **混合检索**: 结合两种方法

### 高级检索
- **多路召回**: 并行使用多种检索方法
- **重排序**: 对检索结果重新排序
- **查询扩展**: 扩展用户查询提高召回率

## 7. Prompt工程

### RAG Prompt设计原则
1. **清晰指示**: 明确告知模型使用提供的上下文
2. **上下文格式**: 结构化呈现检索结果
3. **引用要求**: 要求模型标注信息来源
4. **回答格式**: 指定输出的格式和风格

### 典型Prompt模板
```
请根据以下上下文信息回答用户问题。如果上下文中没有相关信息，请明确说明。

上下文信息：
{context}

用户问题：{question}

请基于上下文信息回答：
```

## 相关链接
- [[向量数据库选型指南]]
- [[Embedding模型性能对比]]
- [[文档分块最佳实践]]
- [[Prompt工程技巧]]

## 实践建议
- [ ] 从简单的文档开始实践
- [ ] 尝试不同的分块大小和策略
- [ ] 对比不同Embedding模型的效果
- [ ] 测试多种相似度计算方法
- [ ] 优化Prompt设计