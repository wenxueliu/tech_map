
面对海量数据的计数器要如何做？


微博的评论数、点赞数、转发数、浏览数、表态数等等；
用户的粉丝数、关注数、发布微博数、私信数等等。

特点
1. 访问量巨大：百万级 TPS
2. 数据量巨大：万亿级数据
3. 对可用性和大数据、数据强一致性要求的挑战

方案

1. mysql进行计数，后来加入了主从架构，分库分表架构。
2. 加入了缓存，但是这个会造成相应的那个缓存和数据库数据不一致，如果要保证一性的话，就需要采用内存队列，对于同一个id的数量只能用单线程进行处理，这个会造成性能问题。
3. 用redis cluster来支持计数服务,因为redis通过rdb和aof来支持持久化，可以通过设置保证至少有一台从redis机器同步了数据，从redis来做相应的那个持久化操作达到数据不丢失，因为原生的redis数据结构会占用比较多的字节，这里直接进行改造，让redis的数据结构占用内存加少。
4. redis + ssd 支持把冷数据放到ssd中，热数据在内存中，当要访问冷数据时利用一个线程异步把冷数据加载到一个cold
cache里面去。这个有很多开源的实现，如Pika，SSDB用ssd来替代内存存储冷数据。




